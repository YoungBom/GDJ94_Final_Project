<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.health.app.approval.ApprovalProductMapper">

<select id="selectProductsByBranch"
        resultType="com.health.app.approval.ApprovalProductDTO">
  SELECT
    p.product_id   AS productId,
    p.product_name AS productName,
    p.product_desc AS productDesc,
    p.price        AS price,
    COALESCE(i.quantity, 0) AS stockQty
  FROM product p
  LEFT JOIN inventory i
    ON i.product_id = p.product_id
   AND i.branch_id  = #{branchId}
   AND i.use_yn     = 1
  WHERE p.use_yn = 1
  ORDER BY p.product_name
</select>

<!-- AT005(구매요청서): product 테이블 전체(사용중) 상품 -->
<select id="selectAllActiveProducts"
        resultType="com.health.app.approval.ApprovalProductDTO">
  SELECT
    p.product_id   AS productId,
    p.product_name AS productName,
    p.product_desc AS productDesc,
    p.price        AS price,
    0              AS stockQty
  FROM product p
  WHERE p.use_yn = 1
  ORDER BY p.product_name
</select>

<!-- AT006(발주서): 본사 재고 기준으로 노출 (지점 inventory 없어도 선택 가능) -->
<select id="selectInventoryProductsByBranch" resultType="com.health.app.approval.ApprovalProductDTO">
  SELECT
    p.product_id   AS productId,
    p.product_name AS productName,
    p.product_desc AS productDesc,
    p.price        AS price,
    COALESCE(hq.quantity, 0) AS stockQty
  FROM inventory hq
  JOIN product p
    ON p.product_id = hq.product_id
   AND p.use_yn     = 1
  WHERE hq.branch_id = 1
    AND hq.use_yn    = 1
  ORDER BY p.product_name
</select>



</mapper>
