# 📑 헬스그룹 통합 ERP 프로젝트 코딩 계획서

## 1. 프로젝트 기본 정보
* **개발 환경**: Java 17, Spring Boot 3.x, MySQL 8.0, AWS EC2
* **핵심 기술**: Spring Data JPA, Querydsl, Spring Security, AWS S3
* **담당자**: 류호석 (정산/통계, 알림, 첨부파일, 일정 관리)
* **데이터베이스 스키마**: `src/main/resources/sql/VITALCORE.sql` 파일 참조

---

## 2. [류호석 파트] 상세 구현 계획

### 💰 정산 및 통계 (Settlement & Statistics)
* **목표**: 지점별/트레이너별 매출 데이터를 집계하고 엑셀로 추출합니다.
* **DB 설계 수정**: 
    * `amount` 관련 필드를 `LONGTEXT`에서 `DECIMAL(18,2)`로 변경 (정밀한 금액 계산)
    * 정산 상태(대기, 확정, 취소)는 Enum으로 관리
* **주요 로직**:
    * 매일 자정, 전날의 거래 데이터를 합산하여 `settlement` 테이블에 저장 (Batch 작업)
    * Apache POI 라이브러리를 이용한 '정산 내역 엑셀 다운로드' 기능 구현

### 🔔 알림 시스템 (Notification)
* **목표**: 결재 요청, 재고 부족 등 중요 이벤트를 실시간으로 알립니다.
* **구현 방식**: 
    * 초기: DB 기반 폴링(Polling) 방식 (5~10초 간격 호출)
    * 고도화: Server-Sent Events(SSE)를 통한 실시간 푸시
* **연동**: 결재자(김동현 님 파트) 혹은 재고 담당자(김성대 님 파트)가 데이터를 생성할 때 알림 서비스 호출

### 📎 공용 첨부파일 (File Management)
* **목표**: 시스템 전체에서 사용하는 파일 업로드/다운로드 공통 모듈 구축.
* **저장소**: AWS S3 인프라 활용.
* **보안 및 관리**:
    * `target_type`과 `target_id`를 사용하여 결재 문서, 공지사항 등과 연결.
    * 삭제 시 실제 파일을 지우지 않고 `use_yn = false` 처리 (논리 삭제).

### 📅 일정 관리 (Schedule)
* **목표**: 전사, 지점, 개인별 일정을 캘린더 형식으로 제공.
* **프론트 연동**: FullCalendar API 규격에 맞춘 JSON 데이터 반환.
* **권한**: 로그인한 사용자의 `branch_id`에 따라 조회 가능한 일정 필터링.

---

### **상세 요구사항 정의**

#### **💰 정산/통계**
| 요구사항 ID | 요구사항 명 | 상세 설명 | 비고 (제약조건 등) |
| :--- | :--- | :--- | :--- |
| ST-001 | 지점별 매출 통계 | * 관리자는 지점별 매출통계를 조회할 수 있다.<br>* 기간 내 지점별 총 매출을 비교할 수 있다.<br>* 전체 평균 매출 금액을 기준으로 매출의 차이(증감)를 확인할 수 있다. | * 폐쇄 지점은 기본적으로 조회 대상에서 제외한다. |
| ST-002 | 항목별 매출 통계 | * 관리자는 항목별 매출통계를 조회할 수 있다.<br>* 항목별 판매 수량 및 매출 금액을 확인할 수있다.<br>* 매출 상위 품목을 기준으로 정렬할 수 있다.<br>* 매출 하위 품목을 기준으로 정렬할 수 있다. | * 취소/반품 건은 집계대상에서 제외함. |
| ST-003 |  기간별 매출 통계  | * 관리자는 기간별로 매출 통계를 조회할 수있다.<br>* 월/분기/연 단위로 매출을 집계한다.<br>* 선택한 기간의 총 매출 금액을 확인할 수있다.<br>* 매출 추이를 그래프 형태로 확인할 수 있다. | * 조회 기간은 필수 입력값으로 지정해둔다. |
| ST-004 | 지점별 지출 통계 | * 관리자는 지점별 매출통계를 조회할 수 있다.<br>* 선택한 기간 내 지점별 총 지출 금액을 확인할 수 있다.<br>* 전체 평균 매출 금액을 기준으로 매출의 차이(증감)를 확인할수 있다. | * 기간 조회는 필수 파라미터로 전달한다.  |
| ST-005 | 항목별 지출 통계 | * 관리자는 지출 항목별 통계를 조회할 수 있다.<br>* 항목별 지출 금액을 확인할 수 있다.<br>* 지출 금액기준으로 항목별 정렬이 가능하다.<br>* 지출 비중이 높은 항목을 확인할 수 있다. | * 항목 분류는 확장이 가능하도록 설계한다. |
| ST-006 | 기간별 지출 통계 | * 관리자는 기간별 지출 통계를 조회할 수 있다.<br>* 월/분기/연 단위로 지출을 집계한다.<br>* 선택한 기간의 총 지출 금액을 확인할 수있다.<br>* 지출 추이를 그래프 형태로 확인할 수 있다. | * 조회 기간은 필수 입력값이다. |
| ST-007 | 정산 대상 매출 조회 | * 관리자는 정산 대상 매출 내역을 조회할 수 있다.<br>* 거래 완료 상태의 매출만 정산 대상에 포함한다.<br>* 매출별 정산 상태(미정산 / 정산완료)를 확인할 수 있다.<br>* 정산 기간 기준으로 조회할 수 있다. | * 거래 완료일을 기준으로 정산한다. |
| ST-008 | 매출 대비 지출 비교 통계 | * 관리자는 매출 대비 지출 비교 통계를 조회할 수 있다.<br>* 동일 기간 기준으로 매출과 지출을 비교할 수 있다.<br>* 지점별 손익(매출 – 지출)을 확인할 수 있다.<br>* 손익 상태(흑자 / 적자)를 시각적으로 확인할 수 있다. | |
| ST-009 | 정산 확정 처리 | * 관리자는 기간별 매출 정산을 확정할 수 있다.<br>* 정산 기간 동안의 총 매출금액을 계산한다.<br>* 정산 확정시 해당 기간의 매출 데이터는 수정할 수 없다.<br>* 정산 완료시 정산 일자를 기록한다. | * 정산 확정 이후엔 수정이 아닌 조회만 가능하게 만든다. |
| ST-010 | 정산 내역 조회 | * 관리자는 정산 완료된 내역을 조회할 수 있다.<br>* 기간별/ 지점별 정산 내역을 조회할 수있다.<br>* 정산 금액, 정산 일자, 처리 담당자 확인을 할 수 있다. | * 정산 이력은 삭제하지 못한다.<br>* !!(추가 기능구현하면 좋은것들) 주후에 이 정산결과에 대해 이제껏 정산 내역을 엑셀파일로 다운로드 할 수있게 하는 기능구현이 있다면 좋을 것 같다. |
| ST-011 | 지출 내역 조회 | * 관리자는 지출 내역을 조회 할 수 있다.<br>* 기간별 / 지점별 지출 내역을 조회할 수 있다.<br>* 지출 금액, 지출 항목, 지출 일자, 처리 담당자를 확인할 수 있다. | * 정산 대상 지출과 일반 지출을 구분할 수 있다. |
| ST-012 | 정산 이력 로그 관리 | * 시스템은 정산 처리 이력을 기록한다.<br>* 정산 확정/취소 시 처리자와 처리 일시를 기록한다. | * 데이터의 추적, 감사 목적의 데이터로 활용될 예정이다.<br>*다른기능 보다 우선도가 낮으므로 모든 기능을 구현한뒤 작업에 들어간다.  |


#### **🔔 알림**
| 요구사항 ID | 요구사항 명 | 상세 설명 | 비고 (제약조건 등) |
| :--- | :--- | :--- | :--- |
| NT-001 | 알림 생성 및 전달 | * 시스템는 주요업무에 알림을 설정 혹은 자동 생성 할수 있어야 한다.<br>* 알림 발생 이벤트는 다음을 포함한다.<br>* 공지사항 등록/수정<br>* 정산 확정/반려<br>* 일정 등록/변경/취소<br>* 파일 첨부 완료<br>* 알림은 개인, 지점, 관리자 등 대상별로 전달된다. | <br>* 알림은 업무 인지 및 처리 보조 목적이다.
 |
| NT-002 | 알림 조회 및 상태 관리  | * 시스템 사용자는 본인의 알림 목록을 조회할 수 있다.<br>* 알림은 최신순으로 정렬하여 표시한다.<br>* 알림은 읽음 / 미읽음 상태를 구분한다.<br>* 알림 클릭 시 관련 업무 화면으로 이동한다. | * 알림 조회 시 읽음 처리 또는 별도 읽음 처리 API를 제공한다. |

#### **📎 공용 첨부파일**
| 요구사항 ID | 요구사항 명 | 상세 설명 | 비고 (제약조건 등) |
| :--- | :--- | :--- | :--- |
| FL-001 | 파일 첨부 및 저장 | * 시스템은 업무 데이터에 파일을 첨부할 수 있다.<br>* 파일 업로드 시 확장자 및 용량을 제한한다. | * 파일은 직접적인 업무 데이터가 아닌 참조 자료로 관리한다.<br>* 대용량 파일 업로드는 제한한다. |
| FL-002 | 파일 조회 및 다운로드 | * 시스템 사용자는 권한에 따라 파일을 초회 및 다운로드할 수 있다.<br>* 삭제된 업무 데이터의 파일은 직접 접근이 제한된다. | * 파일 삭제는 물리 삭제가 아닌 논리 삭제를 기본으로 한다. |

#### **📅 일정 관리**
| 요구사항 ID | 요구사항 명 | 상세 설명 | 비고 (제약조건 등) |
| :--- | :--- | :--- | :--- |
| SC-001 | 일정 등록 | * 시스템 사용자는 개인 또는 업무 일정을 등록할 수 있다.<br>* 일정은 개인 일정, 지점 일정, 공통 일정으로 구분한다.<br>* 일정 정보에는 제목, 기간, 담당자, 설명을 포함한다. | * 일정 유형에 따라 조회 및 수정 권한을 제한한다.<br>*  FullCalendar 라이브러리를 활용 하여 달력을 보여주어 일정을 직관적으로 보여준다 |
| SC-002 | 일정 조회 | * 시스템 사용자는 일정 목록을 조회할 수 있다.<br>* 조회 조건은 기간, 일정 유형, 지점 기준으로 제공한다.<br>* 월/주/일 단위로 일정 확인이 가능하다. | * 과거 일정도 조회 가능하나 수정은 제한할 수 있다. |
| SC-003 | 일정 수정 및 삭제 | * 등록된 일정은 수정 및 삭제가 가능하다.<br>* 일정 수정 시 변경 내용을 사용자에게 확인 시킨다. | * 공통 일정은 관리자만 수정 가능하도록 제한한다. |

---

## 3. 공통 DB 최적화 가이드 (수정 제안)
기존 SQL 문의 성능 및 구조 개선안입니다.

1.  **공통 코드화**: 
    * 직급(사장, 전무 등), 지점 상태 등 반복되는 문자열은 `common_code` 테이블의 ID를 참조하도록 변경.

---

## 4. 팀원 간 협업 가이드 (Communication)

* **API 명칭**: `camelCase` 사용 (예: `getSettlementList`)
* **파일 업로드**: 타 파트에서 파일이 필요할 경우, 류호석 님이 만든 `FileService.upload()`를 주입받아 사용.
* **알림 요청**: 타 파트 비즈니스 로직 종료 시 `NotificationService.send()` 호출.

---

## 5. 마일스톤 (Schedule)
1.  **1주차**: 공용 첨부파일 및 일정 관리 CRUD 완성.
2.  **2주차**: 알림 로직 및 전자결재/재고 파트 연동.
3.  **3주차**: 정산 통계 쿼리 최적화 및 엑셀 다운로드 기능 구현.